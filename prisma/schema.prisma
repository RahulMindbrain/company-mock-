datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum RecordStatus {
  INACTIVE @map("0")
  ACTIVE   @map("1")
}

enum SizeUnit {
  ML
  LTR
  G
  KG
  PCS
}

model AutoNumber {
  id             Int     @id @default(autoincrement())

  companyId      Int

  barcodeId      Int 
  @@unique([companyId])      
  @@index([companyId])
}


model Company {
  id              Int       @id @default(autoincrement())
  
  companyName     String?
  websiteUrl      String?
  printName       String?
  billPrefix      String?          

  beginningDate   DateTime?
  commencingFrom  DateTime?

  addressLine1    String?
  addressLine2    String?

  country         String?
  state           String?

  contactNo1      String?
  contactNo2      String?

  email           String? @unique
  website         String?

  gstNo           String?
  panNo           String?
  vatNo           String?
  fax             String?

  lightLogo       String?        
  darkLogo        String?     

  plans           Plan[]
  admins          Admin[] 
  brands          Brand[]
  products        Product[]
  colors          Color[]


  createdBy  String?
  updatedBy  String?

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([companyName])
  @@index([email])
  @@index([gstNo])
}


model Plan{
  id Int  @id @default(autoincrement())
  companyId        Int? 
  company          Company?  @relation(fields: [companyId], references: [id])
  name             String?
  price            Float?
  BV               Float?
  description      Json?
  isActive         Boolean?
  tax              String?
  config           String?

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Admin {
  id                       Int             @id @default(autoincrement())
  companyId                Int?
  company                  Company?        @relation(fields: [companyId], references: [id])
  
  firstname                String?
  lastname                 String?
  email                    String?         @unique

  countrycode              String?
  mobno1                   String?
  mobno2                   String?

  pinno                    String?
  countryname              String?
  statename                String?
  address                  String?

  password                 String?

  profileimg               String?
  admintype                String?

  walletbalance            Float             @default(0)
  totalwalletadd           Float             @default(0)
  totalwithdraw            Float             @default(0)
  totaltransferwallet      Float             @default(0)

  status                   RecordStatus      @default(ACTIVE)

  createdBy                String?
  updatedBy                String?

  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt

  sessions                 AdminSession[]
  categoriesCreated        Category[]        @relation("CreatedCategories")
  categoriesUpdated        Category[]        @relation("UpdatedCategories")
  BrandCreatedBy           Brand[]           @relation("BrandCreated")
  BrandUpdatedBy           Brand[]           @relation("BrandUpdated")
  productsCreated          Product[]         @relation("ProductCreated")
  productsUpdated          Product[]         @relation("ProductUpdated")
 // sizesCreated             Size[]            @relation("sizesCreated")
 // sizesUpdated             Size[]            @relation("sizesUpdated")
  colorsCreated            Color[]           @relation("colorsCreated")
  colorsUpdated            Color[]           @relation("colorsUpdated")


  @@index([companyId])
  @@index([status])
  @@index([admintype])
}

model AdminSession {
  id         Int       @id @default(autoincrement())
  adminId    Int
  admin      Admin     @relation(fields: [adminId], references: [id])
  userAgent  String?
  ipAddress  String?
  valid      Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}


model Category {
  id            Int              @id @default(autoincrement())
  categoryname  String?
  description   Json?

  status        RecordStatus    @default(ACTIVE)

  products      Product[]

  createdBy     Int?
  createdByUser Admin?           @relation("CreatedCategories", fields: [createdBy], references: [id])

  updatedBy     Int?
  updatedByUser Admin?           @relation("UpdatedCategories", fields: [updatedBy], references: [id])

  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
}


model Brand{
  id               Int              @id @default(autoincrement())
  brandname        String?  
  status           RecordStatus     @default(ACTIVE) 

  products         Product[]

  companyId        Int
  company          Company          @relation(fields: [companyId], references: [id])

  createdById      Int?
  createdBy        Admin?           @relation("BrandCreated", fields: [createdById], references: [id])

  updatedById      Int?
  updatedBy        Admin?           @relation("BrandUpdated", fields: [updatedById], references: [id])

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

}

model Color{

id               Int              @id  @default(autoincrement())
companyId        Int? 
company          Company?         @relation(fields: [companyId], references: [id])
status           RecordStatus     @default(ACTIVE)
createdBy        Int?
createdByUser    Admin?           @relation("colorsCreated", fields: [createdBy], references: [id])

updatedBy        Int?
updatedByUser    Admin?           @relation("colorsUpdated", fields: [updatedBy], references: [id])

 
createdAt        DateTime         @default(now())
updatedAt        DateTime         @updatedAt
}



model Product{

  id               Int               @id @default(autoincrement())
  productname      String

  companyId        Int
  company          Company           @relation(fields: [companyId], references: [id])

  
  categoryId       Int?
  category         Category?         @relation(fields:[categoryId],references:[id],onDelete:Restrict)
  
  brandId          Int?
  brand            Brand?            @relation(fields:[brandId],references:[id],onDelete:Restrict)

 // sizes            Size[] 

  barcodeId        Int                                      
  barcode          String?

  sizeValue        Float?             
  sizeUnit         SizeUnit?            

  sku              String?
  hsncode          String?
  dp               Float?
  mrp              Float?
  taxPercent       Float?
  stock            Int?
  description      String?
  spe              String?

  BV               Float?
  mainImg          String?
  otherImgs        String[]

  status           RecordStatus     @default(ACTIVE)

  createdById      Int?
  createdBy        Admin?           @relation("ProductCreated", fields: [createdById], references: [id], onDelete: SetNull)

  updatedById      Int?
  updatedBy        Admin?           @relation("ProductUpdated", fields: [updatedById], references: [id], onDelete: SetNull)

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt


  @@index([brandId])
  @@index([categoryId])
  @@index([createdById])
  @@index([companyId])
  @@unique([companyId, productname, brandId, sizeValue, sizeUnit])

}

model ProductBarcode {
  id               Int    @id @default(autoincrement())
  companyId        Int
  brandId          Int
  productname      String
  size             String
  barcodeId        Int

  @@unique([companyId, brandId,productname, size])
  @@index([companyId, brandId])
}



// model Size {
//   id               Int             @id @default(autoincrement())
//   value            Float    
//   unit             SizeUnit 
// 
//   productId        Int
//   product          Product          @relation(fields: [productId], references: [id])
// 
//   
//   createdById      Int?
//   createdBy        Admin?           @relation("sizesCreated", fields: [createdById], references: [id], onDelete: SetNull)
// 
//   updatedById      Int?
//   updatedBy        Admin?           @relation("sizesUpdated", fields: [updatedById], references: [id], onDelete: SetNull)
// 
//   createdAt        DateTime         @default(now())
//   updatedAt        DateTime         @updatedAt
// }

